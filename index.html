<script>
const container = document.getElementById("viewer");

const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
  50,
  container.clientWidth / container.clientHeight,
  0.1,
  100
);

// POSISI AMAN (SAMPING)
const defaultCameraPos = new THREE.Vector3(6, 2, 0);
const defaultTarget = new THREE.Vector3(0, 1, 0);

camera.position.copy(defaultCameraPos);

const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
renderer.setSize(container.clientWidth, container.clientHeight);
container.appendChild(renderer.domElement);

// CONTROL
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.target.copy(defaultTarget);
controls.enableDamping = true;
controls.autoRotate = true;
controls.autoRotateSpeed = 1;
controls.minDistance = 4;
controls.maxDistance = 10;

// LIGHT
scene.add(new THREE.AmbientLight(0xffffff, 0.8));
const light = new THREE.DirectionalLight(0xffffff, 0.8);
light.position.set(5, 5, 5);
scene.add(light);

// PC GROUP
const pc = new THREE.Group();
scene.add(pc);

// MATERIAL
const material = new THREE.MeshStandardMaterial({ color: 0xaaaaaa });

// MOTHERBOARD
const mb = new THREE.Mesh(new THREE.BoxGeometry(0.1, 3, 2), material);
mb.position.set(0, 1.5, 0);
pc.add(mb);

// CPU
const cpu = new THREE.Mesh(
  new THREE.BoxGeometry(0.3, 0.3, 0.3),
  new THREE.MeshStandardMaterial({ color: 0xffc107 })
);
cpu.position.set(0.2, 1.6, 0);
pc.add(cpu);

// RAM
const ram = new THREE.Mesh(
  new THREE.BoxGeometry(0.1, 1, 0.3),
  new THREE.MeshStandardMaterial({ color: 0x2196f3 })
);
ram.position.set(0.25, 1.8, 0.6);
pc.add(ram);

// GPU
const gpu = new THREE.Mesh(
  new THREE.BoxGeometry(1.2, 0.3, 0.4),
  new THREE.MeshStandardMaterial({ color: 0x4caf50 })
);
gpu.position.set(0.7, 0.8, 0);
pc.add(gpu);

// PSU
const psu = new THREE.Mesh(
  new THREE.BoxGeometry(0.8, 0.6, 0.6),
  new THREE.MeshStandardMaterial({ color: 0x616161 })
);
psu.position.set(0.7, 0.3, 0);
pc.add(psu);

// DATA PART
const parts = {
  cpu: { obj: cpu, text: "CPU adalah otak komputer yang memproses semua instruksi." },
  gpu: { obj: gpu, text: "GPU mengolah grafis dan tampilan visual." },
  ram: { obj: ram, text: "RAM menyimpan data sementara." },
  mb: { obj: mb, text: "Motherboard menghubungkan semua komponen." },
  psu: { obj: psu, text: "PSU menyuplai daya listrik." }
};

window.focusPart = function(key, btn) {
  document.querySelectorAll("button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");

  const part = parts[key].obj;

  controls.autoRotate = false;
  controls.target.copy(part.position);
  camera.position.set(4, part.position.y, 0);

  const info = document.getElementById("infoBox");
  info.innerText = parts[key].text;
  info.classList.add("show");
};

window.resetView = function() {
  controls.autoRotate = true;
  camera.position.copy(defaultCameraPos);
  controls.target.copy(defaultTarget);
  document.getElementById("infoBox").classList.remove("show");
};

// RESIZE FIX
window.addEventListener("resize", () => {
  camera.aspect = container.clientWidth / container.clientHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(container.clientWidth, container.clientHeight);
});

function animate() {
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene, camera);
}
animate();
</script>
